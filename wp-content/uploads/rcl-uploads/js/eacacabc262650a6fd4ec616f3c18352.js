(function(e,v){"object"===typeof module&&module.exports?module.exports=v(require("jquery")):e.ssi_modal=v(e.jQuery)})(this,function(e){function v(a){return!!a.match(v.regex)}function H(a,b){function c(){var b=e('a[data-ssi_imgGroup="'+k.attr("data-ssi_imgGroup")+'"]');if(b.length){var c=b.index(k),b=b.length;if(!(c+1>=b&&1>c)){var d=e('<div class="ssi-modalNavigation"></divid>').mouseover(function(){d.addClass("ssi-navFadeIn")}).mouseleave(function(){d.removeClass("ssi-navFadeIn")}),h=e('<div class="ssi-modalNext '+ (c+1>=b?"ssi-hidden":"")+'"><span></span></div>'),g=e('<div class="ssi-modalPrev '+(1>c?"ssi-hidden":"")+'"><span></span></div>');d.append(h,g);a.get$backdrop().one("backdropClose.ssi-modal",function(){q=w=""});a.get$modal().one("beforeClose.ssi-modal",function(){d.remove()}).one("onShow.ssi-modal",function(){h.one("click",function(b){b.preventDefault();a.navigate("next");e(this).off("click.ssi_modal")});g.one("click",function(b){b.preventDefault();a.navigate("prev");e(this).off("click.ssi_modal")})}); return d}}}function d(b){f.find(".ssi-loader").remove();var c=[];if(!b&&""!==a.options.imgButtons&&!e.isEmptyObject(a.options.imgButtons)){var d=a.setButtons(a.options.imgButtons,a.get$content()).addClass("ssi-imgButtons");!0===a.options.hideImgButtons&&(d.addClass("ssi-navFade ssi-navFadeOut"),a.get$wrapper().mouseover(function(){d.addClass("ssi-navFadeIn")}).mouseleave(function(){d.removeClass("ssi-navFadeIn")}));c.push(d)}c.push(n);f.append(c)}function h(b,c){clearInterval(B);var e=b||(x?n[0].naturalWidth: n.width()),h=c||(x?n[0].naturalHeight:n.height()),g=a.setModalHeight(120,!0);(h>m-g||e>r)&&!0===a.options.fixedHeight&&(g=Math.min((r-100)/e,(m-g)/h),e*=g,h*=g,2<u&&t.addClass("ssi-overHeight"));f.css("height",h);a.options.center&&f.parent().css({width:e,height:h});t.css("width",e);d();t.addClass("ssi-imgBorder")}function g(){if(x){if(0<n[0].naturalWidth){h();return}}else if(clearInterval(B),50<n.width()){h();return}l=!0}var t=a.get$wrapper(),f=t.find("#ssi-modalContent");if(b&&"#"!=b){var B,l,x= "naturalWidth"in new Image,m=e(window).height(),r=e(window).width(),n=[""],u=0;a.options.navigation&&k&&f.append(c);var p=["jpg","jpeg","png","gif","bmp"];!a.options.allowIframe||-1!==e.inArray(b.split(".").pop().toLowerCase(),p)||v(b)?(n=e('<img src="'+b+'" class="ssi-modalImg"/>').on("load",function(){if(!x){var a=new Image;a.src=n.attr("src");h(a.width,a.height)}}).error(function(){var a=k?k.attr("data-alt"):"";n="<h3>Image not found</h3><br>"+("undefined"!==typeof a?"<h4>"+a+"</h4>":"");d(!0)}), g(),l&&(B=setInterval(function(){t.addClass("ssi-imgBorder");g();u++},50))):("boolean"!==typeof a.options.iframe.allowFullScreen&&(a.options.iframe.allowFullScreen=!0),a.options.iframe.className=a.options.iframe.className||"",n=e('<iframe src="'+b+'" frameborder="0" '+(a.options.iframe.allowFullScreen?"allowfullscreen":"")+"></iframe>"),a.options.center?t.addClass("ssi-iframe ").find("#ssi-modalWindow"+a.numberId).addClass(a.options.iframe.className):t.addClass("ssi-iframe "+a.options.iframe.className), d())}else p=k?k.attr("data-alt"):"",n="<h3>Image not found</h3><br>"+("undefined"!==typeof p?"<h4>"+p+"</h4>":""),d(!0)}function u(a){a instanceof Array||(a=[a]);return a}var G=function(){var a=!1,b=["Webkit","Moz","O","ms","Khtml"],c="",c=document.createElement("div");void 0!==c.style.animationName&&(a=!0);if(!1===a)for(var d=0;d<b.length;d++)if(void 0!==c.style[b[d]+"AnimationName"]){c=b[d];c.toLowerCase();a=!0;break}return a}(),p=0,y=0,r={stackModal:0,normalModal:0},C=0,m=!1,f=function(a){this.numberId= C;this.pluginName=a.stack?"stackModal":"normalModal";this.backdropId="";this.showbd=!0;this.setOptions(a)};f.prototype.setOptions=function(a,b){if("object"===typeof a){var c=this;this.options=e.extend(!0,{content:"",bodyScroll:!1,keepContent:!1,position:"",backdrop:!0,stack:!1,onClickClose:!1,bodyElement:!1,className:"",backdropClassName:"",preview:{icon:!1,hideIcons:!1,state:"normal"},closeAfter:!1,outSideClose:!0,onClose:"",onShow:"",beforeClose:"",beforeShow:"",iframe:{allowFullScreen:!0,className:""}, center:!1,closeIcon:!0,navigation:!1,sizeClass:"medium",animation:!1,modalAnimation:void 0,backdropAnimation:void 0,animationSpeed:300,buttons:[],iconButtons:[],title:"",fixedHeight:!1,fitScreen:!1},a);this.options.iconButtons=u(this.options.iconButtons);this.options.preview.icon&&this.options.iconButtons.push({className:"ssi-displayIcon",method:function(){c.changePreviewState()}});this.options.closeIcon&&this.options.iconButtons.push({className:"ssi-closeIcon",method:function(){c.close()}})}else this.options[a]= b;I(this);return this};f.prototype.init=function(){this.options.backdrop&&this.backdropInit();this.modalInit();C++;return this};f.prototype.get$content=function(){return this.get$modal().find("#ssi-modalContent")};f.prototype.get$modal=function(a){a=a||this.modalId;return this.$modal||e("#"+a)};f.prototype.get$title=function(){return this.get$modal().find("#ssi-modalTitle")};f.prototype.destroyTitle=function(){this.get$title().remove();this.options.title="";return this};f.prototype.destroyContent= function(){this.get$content().remove();this.options.content="";return this};f.prototype.destroyButtons=function(a){this.get$buttons(a).remove();this.options.buttons=[];return this};f.prototype.destroyIcons=function(){this.get$icons().remove();this.options.icons=[];return this};f.prototype.get$icons=function(){return this.get$modal().find(".ssi-topIcons")};f.prototype.get$buttons=function(a){a=a||"buttons";return this.get$modal().find("#ssi-"+a)};f.prototype.get$window=function(){return this.get$modal().find("#ssi-modalWindow")}; f.prototype.get$wrapper=function(){return this.options.stack?this.get$modal().parent():this.get$modal().find("#ssi-modalWrapper")};f.prototype.get$backdrop=function(){return this.$backdrop||e("#"+this.backdropId)};var D=null;f.prototype.changePreviewState=function(){var a=this.get$modal();if("fullScreen"===this.options.preview.state)a.removeClass("ssi-fullScreen"),this.options.preview.state="normal",a.find("#ssi-modalContent").css("height",""),(this.options.fixedHeight||this.options.fitScreen)&&this.setModalHeight(), clearTimeout(D),a.off("mousemove.ssi-modal");else{if(this.options.preview.hideIcons){var b=a.find(".ssi-topIcons");if(this.options.buttons)var c=a.find("#ssi-buttons");a.on("mousemove.ssi-modal",function(){clearTimeout(D);b.fadeIn();c.slideDown();D=setTimeout(function(){c.slideUp();b.fadeOut()},2E3)})}this.setModalHeight(40,"height");a.addClass("ssi-fullScreen");this.options.preview.state="fullScreen"}return this};f.prototype.setPluginName=function(a){this.pluginName=a;r[a]=0;return this};f.prototype.setContent= function(a,b){b=b||"html";var c;!0!==this.options.content?(c=e('<div id="ssi-modalContent" class="ssi-modalContent '+(this.options.fixedHeight?"ssi-overflow ":"")+'"></div>'),""===this.options.content&&(!0===this.options.title?this.get$title().after(c):this.get$window().prepend(c),this.setModalHeight()),this.options.content=!0):c=this.get$content();var d=a;if(a instanceof e&&!0===this.options.bodyElement){if(!0===this.options.extendOriginalContent){var h=this.options.beforeClose;this.options.beforeClose= function(b){var c;"function"===typeof h&&(c=h(b));if(!1!==c)a.eq(0).after(b.get$content().contents().unwrap().css("display","")).remove();else return c}}d=a.eq(0).clone();d.is(":visible")||d.show()}c[b](d);return c};f.prototype.setButtons=function(a,b){var c,d=!1;a=u(a);!1!==b&&(b="undefined"!==typeof b?e(b):this.get$window(),c=b.find("#ssi-buttons"),c=c[0]);c||(c=e('<div id="ssi-buttons" class="ssi-buttons"><div id="ssi-leftButtons" class="ssi-leftButtons"></div><div id="ssi-rightButtons" class="ssi-rightButtons"></div></div>'), b&&(d=!0,b.append(c)),this.options.buttons=!0);for(var h=a.length,g=c.find("#ssi-leftButtons"),f=c.find("#ssi-rightButtons"),F=[],k=[],l=0,m;l<h;l++)m=this.generateButton(a[l]),"left"===a[l].side?F.push(m):k.push(m);g.append(F);f.append(k);d&&this.setModalHeight();return c};var z=function(a,b){switch(typeof a){case "boolean":a="show"===b?a?"anim ssi-fadeIn":"ssi-show":a?"anim ssi-fadeOut":"ssi-hidden";break;case "undefined":a="show"===b?"ssi-show":"ssi-hidden"}return a},I=function(a){var b=a.options.modalAnimation|| a.options.animation||!1,c=a.options.backdropAnimation||a.options.animation||!1,d;d=z("undefined"!==typeof b.show?b.show:b,"show");b=z("undefined"!==typeof b.hide?b.hide:b,"hide");a.options.modalAnimation={show:d,hide:b};d=z("undefined"!==typeof c.show?c.show:c,"show");b=z("undefined"!==typeof c.hide?c.hide:c,"hide");a.options.backdropAnimation={show:d,hide:b};!1===G&&(a.options.modalAnimation={show:"ssi-show"!==a.options.modalAnimation.show?"anim ssi-fadeIn":"ssi-show",hide:"ssi-hidden"!==a.options.modalAnimation.hide? "anim ssi-fadeOut":"ssi-hidden"},a.options.backdropAnimation={show:"ssi-show"!==a.options.backdropAnimation.show?"anim ssi-fadeIn":"ssi-show",hide:"ssi-hidden"!==a.options.backdropAnimation.hide?"anim ssi-fadeOut":"ssi-hidden"})},J=function(a){var b=a.get$modal();a.time=setTimeout(function(){a.close()},1E3*a.options.closeAfter.time);if(a.options.closeAfter.displayTime&&a.options.title){var c=b.find("span.ssi-displayTime").html(a.options.closeAfter.time);E(a,c,function(){a.$displayTime.remove()})}a.options.closeAfter.resetOnHover&& (b.on("mouseenter.ssi-modal",function(){clearTimeout(a.time);c&&(c.html(a.options.closeAfter.time),clearInterval(a.countDown))}),b.on("mouseleave.ssi-modal",function(){a.time=setTimeout(function(){a.close()},1E3*a.options.closeAfter.time);a.options.closeAfter.displayTime&&a.options.title&&E(a,c,function(){c.parent().remove()})}))};f.prototype.backdropInit=function(){var a;if("string"===typeof m)a=e("#"+m),this.backdropId=m,a=a.attr("class","ssi-backdrop "+this.pluginName+" "+this.options.backdropClassName), this.showbd=!1,m=!0;else{a=e('<div id="ssi-backdrop'+this.numberId+'" class="ssi-backdrop ssi-hidden '+this.options.backdropClassName+" "+this.pluginName+'"></div>');if("shared"===this.options.backdrop||"byKindShared"===this.options.backdrop){var b;b="byKindShared"===this.options.backdrop?e(".ssi-backdrop.ssi-openedDialog."+this.pluginName):e(".ssi-backdrop.ssi-openedDialog");b[0]?(this.backdropId=b.attr("id"),this.showbd=!1,a=b):(e("body").append(a),this.backdropId="ssi-backdrop"+this.numberId,this.showbd= !0)}else!0===this.options.backdrop&&(e("body").append(a),this.backdropId="ssi-backdrop"+this.numberId,this.showbd=!0);this.$backdrop=a}if(this.options.outSideClose&&this.options.position){var c=this;a.on("click.ssi-modal"+this.numberId,function(a){a.preventDefault();c.close()})}return a};f.prototype.setIcons=function(a){var b,c=[];!0!==this.options.iconButtons?(b=e('<div class="ssi-topIcons"></div>'),this.options.iconButtons=!0):b=this.get$icons();for(var d=this,h=a.length,g=0,f;g<h;g++)f=a[g],function(a){c.push(e('<a class="'+ a.className+'"></a>').click(function(b){b.preventDefault();"function"===typeof a.method&&e.proxy(a.method,this)(b,d)}))}(f);b.append(c);return b};var K=function(a){var b=e('<div id="ssi-modalWindow" class="ssi-modalWindow '+(a.options.center?a.options.sizeClass:"")+(a.options.stack?" "+a.options.sizeClass+" "+a.options.className+" ":"")+'"></div>'),c="",d=[];a.options.content&&(c=a.setContent(a.options.content,"html"));a.options.title&&d.push(a.setTitle(a.options.title));a.options.onClickClose&&b.addClass("ssi-hover").click(function(b){b= e(b.target);b.is("a")||b.is("button")||a.close()});0<a.options.iconButtons.length&&d.push(a.setIcons(a.options.iconButtons,!0));d.push(c);"undefined"===typeof a.options.buttons||e.isEmptyObject(a.options.buttons)||d.push(a.setButtons(a.options.buttons,!1));b.append(d);return b};f.prototype.generateButton=function(a){a=e.extend({},{className:"",enableAfter:!1,method:function(){},type:"button",focused:!1,id:"",label:"",modalAnimation:"",backdropAnimation:""},a);var b="button",c="",d=this,h;"link"=== a.type&&(b="a",c=' href="#"');var g=e("<"+b+c+(a.id?' id="'+a.id+'"':" ")+(a.enableAfter?"disabled ":"")+' class="ssi-modalBtn '+(a.className||"")+'">'+a.label+"</"+b+">");if("number"===typeof a.enableAfter){var f=e('<span class="ssi-countDown">'+a.enableAfter+"</span>");E(d,f,function(){g.removeClass("disabled");g.removeAttr("disabled");f.remove()});g.append(f)}if(a.keyPress)e("body").on("keydown.ssi_modal",function(b){b.keyCode!=a.keyPress||g.is(":disabled")||g.trigger("click")});a.focused&&setTimeout(function(){g.focus()}, 100);return g.click(function(b){b.preventDefault();a.clearTimeOut&&(clearTimeout(d.time),d.time=null,clearInterval(d.countDown));"function"===typeof a.method&&(h=e.proxy(a.method,this)(b,d));!1!==h&&("boolean"===typeof a.keepContent&&a.keepContent!==d.options.keepContent&&(d.options.keepContent=a.keepContent),a.closeAfter&&d.close())})};f.prototype.modalInit=function(){var a=K(this),b=this;if(this.options.position&&this.options.stack){var c="append";-1<this.options.position.indexOf("bottom")&&(c= "prepend");var d=this.options.position.replace(" ","."),d=e("div.ssi-modalOuter.ssi-stack."+d);if(d[0])d.find("#ssi-modalWrapper")[c](a);this.$modal=a}if(!this.options.stack||!d[0]){var h=e('<div id="ssi-modalWrapper" class=" ssi-modalWrapper '+this.options.sizeClass+'"></div>'),f=e('<div class="ssi-modalOuter '+(this.options.stack?" ssi-stack":""+this.options.className)+(this.options.center?" ssi-center ":" ")+" "+(this.options.position?" ssi-modalPositioned "+this.options.position:"")+'"></div>').append(h.append(a)).appendTo(e("body")); this.options.stack||(this.$modal=f,f.one("onShow.ssi-modal",function(){!0===b.options.outSideClose&&(f.click(function(a){a.target===this&&(a.preventDefault(),b.close())}),h.click(function(a){a.target===this&&(a.preventDefault(),b.close())}))}))}this.modalId="ssi-"+this.pluginName+this.numberId;this.$modal.attr("id","ssi-"+this.pluginName+this.numberId);this.$modal.addClass(this.pluginName+" ssi-modal");this.$modal.data("ssi-modal",this).addClass("ssi-hidden");"string"===typeof m&&this.backdropInit(); return this.$modal};f.prototype.setTitle=function(a){var b,c=!1;!0!==this.options.title?(b=e('<div id="ssi-modalTitle" class="ssi-modalTitle '+(this.options.content?"":"ssi-borderOut ")+'">'+this.options.title+"</div>"),""===this.options.title&&(this.get$window().prepend(b),c=!0),this.options.title=!0):b=this.get$title();b.html(a);c&&this.setModalHeight();return b};f.prototype.showModal=function(){var a=this.get$modal(),b=this;setTimeout(function(){a.trigger("beforeShow.ssi-modal")},0);!1===this.options.bodyScroll&& (e("body").addClass("ssi-modalOpen"),p++);"shared"===this.options.backdrop?y++:"byKindShared"===this.options.backdrop&&r[this.pluginName]++;a.addClass("ssi-openedDialog");var c=function(){e(this).removeClass("ssi-hidden");if("function"===typeof b.options.onShow)b.options.onShow(b);setTimeout(function(){a.trigger("onShow.ssi-modal")},0)};a.addAnimation(this.options.modalAnimation.show,function(){c()}).removeClass("ssi-hidden");this.options.center&&a.css("display","");"fullScreen"===b.options.preview.state&& (b.options.preview.state="normal",b.changePreviewState());this.setModalHeight();"number"===typeof this.options.closeAfter.time&&J(this);delete this.$modal};f.prototype.showBackdrop=function(){this.get$backdrop().addClass("ssi-openedDialog").addAnimation(this.options.backdropAnimation.show).removeClass("ssi-hidden");delete this.$backdrop};f.prototype.show=function(){if("function"===typeof this.options.beforeShow&&!1===this.options.beforeShow(this))return this;this.showModal();!1===m&&this.options.backdrop&& !0===this.showbd&&this.showBackdrop();return this};f.prototype.destroyBackdrop=function(){var a=this.get$backdrop(),b=this;!0!==this.options.keepContent&&a.off("click.ssi-modal"+this.numberId);var c=this,d=function(){!0!==c.options.backdrop&&(!("shared"===c.options.backdrop&&1>y||"byKindShared"===c.options.backdrop&&1>r[c.pluginName])||c.get$modal(c.modalId.replace(c.numberId.toString(),c.backdropId.replace("ssi-backdrop","")))[0]&&c.backdropId.replace("ssi-backdrop","")!=c.numberId)||a.addAnimation(c.options.backdropAnimation.hide, function(){a.addClass("ssi-hidden").removeClass("ssi-openedDialog");a.trigger("backdropClose.ssi-modal");!0!==b.options.keepContent&&a.remove()});m===c.backdropId&&(m=!1)};this.options.stack&&this.options.outSideClose?setTimeout(d,10):d();return this};f.prototype.destroyModal=function(){var a=this.get$modal(),b=this;a.off(".ssi_modal");a.trigger("beforeClose.ssi-modal");"shared"===this.options.backdrop?y--:"byKindShared"===this.options.backdrop&&r[this.pluginName]--;a.hasClass("ssi-openedDialog")&& (a.removeClass("ssi-openedDialog"),!1===this.options.bodyScroll&&p--);a.addAnimation(this.options.modalAnimation.hide,function(){a.addClass("ssi-hidden");b.options.stack?a.addClass("ssi-smoothSlide").slideUp("500",function(){a.removeClass("ssi-smoothSlide");a.trigger("onClose.ssi-modal");!0!==b.options.keepContent&&a.remove()}):(a.trigger("onClose.ssi-modal"),!0!==b.options.keepContent&&a.remove());if("function"===typeof b.options.onClose)b.options.onClose(b);!0!==b.options.keepContent&&a.off(".ssi-modal").find("#ssi-modalWrapper").off(".ssi-modal")}); this.options.icons=[];this.options.buttons=[];this.options.content="";this.options.title="";m=this.backdropId;return this};f.prototype.close=function(){if("function"===typeof this.options.beforeClose&&!1===this.options.beforeClose(this))return this;var a=e("body");a.off(".ssi_modal");this.destroyModal();this.destroyBackdrop();1>p&&a.removeClass("ssi-modalOpen");clearTimeout(this.time);this.time=null;clearInterval(this.countDown);return this};f.prototype.setModalHeight=function(a,b){if(!this.options.fitScreen&& !this.options.fixedHeight&&!b)return this;"number"!==typeof a&&(a=100);var c=this.get$content(),d=e(window).height(),f=0,g=0;this.options.buttons&&(f=c.next().innerHeight());this.options.title&&(g=this.get$title().innerHeight());f=f+g+a;g=0;b?"string"===typeof b&&c.css(b,d-f):this.options.fitScreen&&this.options.fixedHeight?("number"===typeof this.options.fitScreen&&(g=Math.abs((this.options.fitScreen+this.options.fixedHeight)/2-a)),c.css("height",d-f-g)):(this.options.fitScreen&&("number"===typeof this.options.fitScreen&& (g=Math.abs(this.options.fitScreen-a)),c.css("min-height",d-f-g)),this.options.fixedHeight&&(g=0,"number"===typeof this.options.fixedHeight&&(g=Math.abs(this.options.fixedHeight-a)),c.css("max-height",d-f-g)));return f};var E=function(a,b,c){a.countDown=setInterval(function(){var d=parseInt(b.html());0!==d-1?b.html(d-1):(c&&c(),clearInterval(a.countDown))},1E3)};e.fn.extend({hasClasses:function(a){for(var b in a)if(e(this).hasClass(a[b]))return!0;return!1}});var l={checkElement:function(a){a=e(a); if(a[0]){var b=a.data("ssi-modal");if(b&&!e("#"+b.modalId)[0])return a.data("ssi-modal",""),!1}return b?b:!1},createObject:function(a,b){var c,d;"undefined"!==typeof b?(c=e(b),d=c.data("ssi-modal")):a.keepContent=!1;d||(d=new f(a),"undefined"!==typeof b&&c.data("ssi-modal",d));return d},show:function(a,b){var c=!1;b&&(c=this.checkElement(b));if(!1===c)return this.createObject(a,b).init().show();if("object"===typeof c)return c.show()},close:function(a){a||(a=e(".ssi-modalOuter"),a=a.eq(a.length-1)); return a.data("ssi-modal").close()},proto:f.prototype,closeAll:function(a,b){function c(a){for(var c=a.length-1;0<=c;c--){var d=a.eq(c);d.hasClasses(b)||d.data("ssi-modal").close()}}b=u(b);var d;d=typeof a;if("string"===d&&""!==a||"array"===d){a=u(a);for(var f=a.length,g=0;g<f;g++)d=e(".ssi-modal.ssi-openedDialog."+a[g]),c(d)}else d=e(".ssi-modal.ssi-openedDialog"),c(d)},removeAll:function(){e(".ssi-modalOuter").addClass("ssi-hidden").remove();e(".ssi-backdrop").addClass("ssi-hidden").remove();e("body").removeClass("ssi-modalOpen"); y=p=0;r={stackModal:0,normalModal:0};C=0},dialog:function(a,b){var c={sizeClass:"dialog",okBtn:{className:"",label:"Ok"},title:"",closeIcon:!1,outSideClose:!1};a.okBtn=e.extend({},c.okBtn,a.okBtn);a=e.extend({},c,a);a.buttons=[{className:a.okBtn.className,label:a.okBtn.label,closeAfter:!0,method:b}];return(new f(a)).init().show()},confirm:function(a,b){var c={okBtn:{className:"",label:"Ok"},cancelBtn:{className:"",label:"Cancel"},closeIcon:!1,sizeClass:"dialog",title:"",outSideClose:!1};a.okBtn=e.extend({}, c.okBtn,a.okBtn);a.cancelBtn=e.extend({},c.cancelBtn,a.cancelBtn);a=e.extend({},c,a);a.buttons=[{className:a.okBtn.className,label:a.okBtn.label,closeAfter:!0,method:function(a,c){"function"===typeof b&&b(!0,a,c)}},{className:a.cancelBtn.className,label:a.cancelBtn.label,closeAfter:!0,method:function(a,c){"function"===typeof b&&b(!1,a,c)}}];return(new f(a)).init().show()}};v.regex=/^\s*data:([a-z]+\/[a-z0-9\-\+]+(;[a-z\-]+\=[a-z0-9\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i; var A={"ssi-mainOption":{}};l.imgBox=function(a,b){A[b||"ssi-mainOption"]=e.extend({},A["ssi-mainOption"],a)};var q,w,k;l.proto.navigate=function(a){var b=e('a[data-ssi_imgGroup="'+k.attr("data-ssi_imgGroup")+'"]');q||(q=b.index(k));w||(w=b.length);if("next"===a&&q+1>=w||"prev"===a&&0>q)return this;this.destroyModal();"next"===a?q++:"prev"===a&&q--;b.eq(q).trigger("click.ssi-imgBox");return this};l.imgBox.show=function(a,b){b=e.extend(!0,{backdrop:"byKindShared",fixedHeight:!0,navigation:!0,closeIcon:!0, title:!1,allowIframe:!0,hideImgButtons:!0},b);e.extend(b,{img:!0,content:'<div class="ssi-loader"></div>',sizeClass:""});var c=l.createObject(b).setPluginName("imgBox");c.imgUrl=a;c.imgTitle=b.title;c.init();b.title&&c.get$icons().addClass("inTitle");c.show();H(c,a)};e("body").on("click.ssi-imgBox","a.ssi-imgBox",function(a){a.preventDefault();a.stopPropagation();k=e(a.currentTarget);a=k.attr("data-ssi_imgGroup")||"ssi-mainOption";a=A[a]||A["ssi-mainOption"];var b=k.attr("href");if(""!==a.imgButtons&& !e.isEmptyObject(a.imgButtons))for(var c=0;c<a.imgButtons.length;c++)if(a.imgButtons[c].exclude)for(var d=a.imgButtons[c].exclude.split(","),f=0;f<d.length;f++)if(k.hasClass(d[f])){a.imgButtons.splice(c,1);break}a.title&&!0===a.title&&(a.title=k.attr("title"));l.imgBox.show(b,a,k)});l.notify=function(a,b,c){var d={closeIcon:!1,overrideOther:!1,sizeClass:"dialog",onClickClose:!0,bodyScroll:!0,animation:!0,className:"",backdrop:!1,outSideClose:!1,position:"right top",topZIndex:!0,okBtn:{className:"", label:"Ok"},cancelBtn:{className:"",label:"Cancel"},stack:!0,closeAfter:{time:4,resetOnHover:!0}};b.okBtn=e.extend({},d.okBtn,b.okBtn);b.cancelBtn=e.extend({},d.cancelBtn,b.cancelBtn);var f="",g="";switch(a){case "success":d.className=" ssi-success";break;case "error":d.className=" ssi-error";break;case "info":d.className=" ssi-info";break;case "warning":d.className=" ssi-warning";break;case "confirm":d.closeAfter=!1;d.onClickClose=!1;d.outSideClose=!1;d.icon=!1;d.title=!1;d.buttons=[{className:b.okBtn.className, label:b.okBtn.label,closeAfter:!0,method:function(){"function"===typeof c&&c(!0)}},{className:b.cancelBtn.className,label:b.cancelBtn.label,closeAfter:!0,method:function(){"function"===typeof c&&c(!1)}}];break;case "dialog":d.onClickClose=!1;d.closeAfter=!1;d.outSideClose=!1;d.title=!1;d.icon=!1;d.buttons=[{className:b.okBtn.className,label:b.okBtn.label,closeAfter:!0,method:c}];break;default:d.className=a}b.className&&(b.className+=d.className||"");b=e.extend(!0,d,b);0!=b.icon&&(f=b.icon||a||""); 0!=b.title&&(g=b.title||a);0!=b.icon&&0!=b.title&&""!=f&&(b.title=(""===f?"":'<span class="ssi-icon '+f+'"></span>')+" "+g);!0===b.backdrop&&(b.backdrop="byKndShared");b.keepContent=!1;b.overrideOther&&(a=b.position.split(" "),e("body").find("div."+a[0]+"."+a[1]).children().empty());return l.createObject(b).setPluginName("notify").init().show()};e.fn.ssi_modal=function(a,b,c){var d;if("object"===typeof b){var f=a;d=b||{};var g=c}else d=a||{};return this.each(function(){var a=e(this),b;if(d.content)a.click(function(){switch(f){case "show":l.show(d, a);break;default:l[f](d,g)}});else{var c,k,m=a.attr("data-ssi_modal");m?a.click(function(){c=e(m);k={content:c};b=e.extend({},d,k);l.createObject(b).init().show()}):(k={content:a},b=e.extend({},d,k),l.createObject(b).init().show())}})};e.fn.addAnimation=function(a,b){if(-1!==a.indexOf("ssi-fade")&&!1===G)return e(this)[a.replace("anim ssi-","")](300,function(){"function"===typeof b&&b()});e(this).addClass(a).one("mozAnimationEnd webkitAnimationEnd MSAnimationEnd oanimationend animationend",function(){e(this).removeClass(a); "function"===typeof b&&b()});"ssi-show"!==a&&"ssi-hidden"!==a&&""!==a||e(this).trigger("animationend");return this.each(function(){e(this)})};return l}); var rcl_actions = []; var rcl_filters = []; var rcl_beats = []; var rcl_beats_delay = 0; var rcl_url_params = rcl_get_value_url_params(); jQuery.fn.extend({ animateCss: function (animationNameStart,functionEnd) { var animationEnd = 'webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend'; this.addClass('animated ' + animationNameStart).one(animationEnd, function() { jQuery(this).removeClass('animated ' + animationNameStart); if(functionEnd){ if(typeof functionEnd == 'function'){ functionEnd(this); }else{ jQuery(this).animateCss(functionEnd); } } }); return this; } }); function rcl_do_action(action_name){ var callbacks_action = rcl_actions[action_name]; if(!callbacks_action) return false; var args = [].slice.call(arguments, 1); callbacks_action.forEach(function(callback, i, callbacks_action) { window[callback].apply(this, args); }); } function rcl_add_action(action_name,callback){ if(!rcl_actions[action_name]){ rcl_actions[action_name] = [callback]; }else{ var i = rcl_actions[action_name].length; rcl_actions[action_name][i] = callback; } } function rcl_apply_filters(filter_name){ var args = [].slice.call(arguments, 1); var callbacks_filter = rcl_filters[filter_name]; if(!callbacks_filter) return args[0]; callbacks_filter.forEach(function(callback, i, callbacks_filter) { args[0] = window[callback].apply(this, args); }); return args[0]; } function rcl_add_filter(filter_name,callback){ if(!rcl_filters[filter_name]){ rcl_filters[filter_name] = [callback]; }else{ var i = rcl_filters[filter_name].length; rcl_filters[filter_name][i] = callback; } } function rcl_get_value_url_params(){ var tmp_1 = new Array(); var tmp_2 = new Array(); var rcl_url_params = new Array(); var get = location.search; if(get !== ''){ tmp_1 = (get.substr(1)).split('&'); for(var i=0; i < tmp_1.length; i++) { tmp_2 = tmp_1[i].split('='); rcl_url_params[tmp_2[0]] = tmp_2[1]; } } return rcl_url_params; } function rcl_is_valid_url(url){ var objRE = /http(s?):\/\/[-\w\.]{3,}\.[A-Za-z]{2,3}/; return objRE.test(url); } function setAttr_rcl(prmName,val){ var res = ''; var d = location.href.split("#")[0].split("?"); var base = d[0]; var query = d[1]; if(query) { var params = query.split("&"); for(var i = 0; i < params.length; i++) { var keyval = params[i].split("="); if(keyval[0] !== prmName) { res += params[i] + '&'; } } } res += prmName + '=' + val; return base + '?' + res; } function rcl_update_history_url(url){ if(url != window.location){ if ( history.pushState ){ window.history.pushState(null, null, url); } } } function rcl_init_cookie(){ jQuery.cookie = function(name, value, options) { if (typeof value !== 'undefined') { options = options || {}; if (value === null) { value = ''; options.expires = -1; } var expires = ''; if (options.expires && (typeof options.expires === 'number' || options.expires.toUTCString)) { var date; if (typeof options.expires === 'number') { date = new Date(); date.setTime(date.getTime() + (options.expires * 24 * 60 * 60 * 1000)); } else { date = options.expires; } expires = '; expires=' + date.toUTCString(); } var path = options.path ? '; path=' + (options.path) : ''; var domain = options.domain ? '; domain=' + (options.domain) : ''; var secure = options.secure ? '; secure' : ''; document.cookie = [name, '=', encodeURIComponent(value), expires, path, domain, secure].join(''); } else { var cookieValue = null; if (document.cookie && document.cookie !== '') { var cookies = document.cookie.split(';'); for (var i = 0; i < cookies.length; i++) { var cookie = jQuery.trim(cookies[i]); if (cookie.substring(0, name.length + 1) === (name + '=')) { cookieValue = decodeURIComponent(cookie.substring(name.length + 1)); break; } } } return cookieValue; } }; } function rcl_add_dynamic_field(e){ var parent = jQuery(e).parents('.dynamic-value'); var box = parent.parent('.dynamic-values'); var html = parent.html(); box.append('<span class="dynamic-value">'+html+'</span>'); jQuery(e).attr('onclick','rcl_remove_dynamic_field(this);return false;').children('i').toggleClass("fa-plus fa-minus"); box.children('span').last().children('input').val('').focus(); } function rcl_remove_dynamic_field(e){ jQuery(e).parents('.dynamic-value').remove(); } function rcl_update_require_checkbox(e){ var name = jQuery(e).attr('name'); var chekval = jQuery('form input[name="'+name+'"]:checked').val(); if(chekval) jQuery('form input[name="'+name+'"]').attr('required',false); else jQuery('form input[name="'+name+'"]').attr('required',true); } function rcl_rand( min, max ) { if( max ) { return Math.floor(Math.random() * (max - min + 1)) + min; } else { return Math.floor(Math.random() * (min + 1)); } } function rcl_notice(text,type,time_close){ time_close = time_close || false; var options = { text: text, type: type, time_close: time_close }; options = rcl_apply_filters('rcl_notice_options',options); var notice_id = rcl_rand(1, 1000); var html = '<div id="notice-'+notice_id+'" class="notice-window type-'+options.type+'"><a href="#" class="close-notice"><i class="rcli fa-times"></i></a>'+options.text+'</div>'; if(!jQuery('#rcl-notice').size()){ jQuery('body > div').last().after('<div id="rcl-notice">'+html+'</div>'); }else{ if(jQuery('#rcl-notice > div').size()) jQuery('#rcl-notice > div:last-child').after(html); else jQuery('#rcl-notice').html(html); } jQuery('#rcl-notice > div').last().animateCss('slideInLeft'); if(time_close){ setTimeout(function () { rcl_close_notice('#rcl-notice #notice-'+notice_id) }, options.time_close); } } function rcl_close_notice(e){ jQuery(e).animateCss('flipOutX',function(e){ jQuery(e).hide(); }); } function rcl_preloader_show(e,size){ var font_size = (size)? size: 80; var margin = font_size/2; var options = { size: font_size, margin: margin, icon: 'fa-circle-o-notch', class: 'rcl_preloader' }; options = rcl_apply_filters('rcl_preloader_options',options); var style = 'style="font-size:'+options.size+'px;margin: -'+options.margin+'px 0 0 -'+options.margin+'px;"'; var html = '<div class="'+options.class+'"><i class="rcli '+options.icon+' fa-spin" '+style+'></i></div>'; if(typeof( e ) === 'string') jQuery(e).after(html); else e.append(html); } function rcl_preloader_hide(){ jQuery('.rcl_preloader').remove(); } function rcl_setup_datepicker_options(){ jQuery.datepicker.setDefaults(jQuery.extend(jQuery.datepicker.regional["ru"])); var options = { monthNames: [ "Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь" ], dayNamesMin: ["Вс", "Пн", "Вт", "Ср", "Чт", "Пт", "Сб"], firstDay: 1, dateFormat: 'yy-mm-dd', yearRange: "1950:c+3", changeYear: true }; options = rcl_apply_filters('rcl_datepicker_options',options); return options; } function rcl_show_datepicker(e){ jQuery(e).datepicker(rcl_setup_datepicker_options()); jQuery(e).datepicker( "show" ); rcl_add_action('rcl_upload_tab','rcl_remove_datepicker_box'); } function rcl_remove_datepicker_box(){ jQuery('#ui-datepicker-div').remove(); } function rcl_init_field_file(field_id){ jQuery("#"+field_id).parents('form').attr("enctype","multipart/form-data"); } function rcl_init_runner(props){ var box = jQuery( '#rcl-runner-' + props.id ); box.children('.rcl-runner-box').slider({ value : parseInt(props.value), min : parseInt(props.min), max : parseInt(props.max), step : parseInt(props.step), create: function( event, ui ) { var value = box.children('.rcl-runner-box').slider( 'value' ); box.children('.rcl-runner-value').text( value ); box.children('.rcl-runner-field').val( value ); }, slide: function( event, ui ) { box.find('.rcl-runner-value').text( ui.value ); box.find('.rcl-runner-field').val( ui.value ); } }); } function rcl_init_range(props){ var box = jQuery( '#rcl-range-' + props.id ); box.children('.rcl-range-box').slider({ range: true, values : [ parseInt(props.values[0]), parseInt(props.values[1]) ], min : parseInt(props.min), max : parseInt(props.max), step : parseInt(props.step), create: function( event, ui ) { var values = box.children('.rcl-range-box').slider( 'values' ); box.children('.rcl-range-value').text( values[0] + ' - ' + values[1]); box.children('.rcl-range-min').val( values[0] ); box.children('.rcl-range-max').val( values[1] ); }, slide: function( event, ui ) { box.children('.rcl-range-value').text( ui.values[0] + ' - ' + ui.values[1] ); box.find('.rcl-range-min').val( ui.values[0] ); box.find('.rcl-range-max').val( ui.values[1] ); } }); } function rcl_init_color(id, props){ jQuery("#"+id).wpColorPicker(props); } function rcl_init_field_maxlength(fieldID){ var field = jQuery('#'+fieldID); var maxlength = field.attr('maxlength'); if(!field.parent().find('.maxlength').size()){ if(field.val()){ maxlength = maxlength - field.val().length; } field.after('<span class="maxlength">'+maxlength+'</span>'); } field.on('keyup', function(){ var maxlength = jQuery(this).attr('maxlength'); if(!maxlength) return false; var word = jQuery(this); var count = maxlength - word.val().length; jQuery(this).next().text(count); if(word.val().length > maxlength) word.val(word.val().substr(0, maxlength)); }); } function rcl_init_ajax_editor(id,options){ if(typeof QTags === 'undefined') return false; rcl_do_action('rcl_pre_init_ajax_editor',{id:id,options:options}); var qt_options = { id: id, buttons: (options.qt_buttons)? options.qt_buttons: "strong,em,link,block,del,ins,img,ul,ol,li,code,more,close" }; QTags( qt_options ); QTags._buttonsInit(); if(options.tinymce){ tinyMCEPreInit.qtInit[id] = qt_options; tinyMCEPreInit.mceInit[id] = { body_class: id, selector: '#'+id, menubar: false, skin: "lightgray", theme: 'modern', toolbar1: "formatselect,bold,italic,bullist,numlist,blockquote,alignleft,aligncenter,alignright,link,unlink,wp_more,spellchecker,fullscreen,wp_adv", toolbar2: "strikethrough,hr,forecolor,pastetext,removeformat,charmap,outdent,indent,undo,redo,wp_help", wpautop: true }; tinymce.init(tinyMCEPreInit.mceInit[id]); tinyMCE.execCommand('mceAddEditor', true, id); switchEditors.go(id, 'html'); } } function rcl_setup_quicktags(newTags){ if(typeof QTags === 'undefined') return false; newTags.forEach(function(tagArray, i, newTags) { QTags.addButton( tagArray[0], tagArray[1], tagArray[2], tagArray[3], tagArray[4], tagArray[5], tagArray[6] ); }); } rcl_add_action('rcl_pre_init_ajax_editor','rcl_add_ajax_quicktags'); function rcl_add_ajax_quicktags(editor){ if(typeof Rcl === 'undefined' || !Rcl.QTags) return false; rcl_setup_quicktags(Rcl.QTags); } rcl_add_action('rcl_footer','rcl_add_quicktags'); function rcl_add_quicktags(){ if(typeof Rcl === 'undefined' || !Rcl.QTags) return false; rcl_setup_quicktags(Rcl.QTags); } function rcl_proccess_ajax_return(result){ var methods = { redirect: function(url){ var urlData = url.split('#'); if(window.location.origin + window.location.pathname === urlData[0]){ location.reload(); }else{ location.replace(url); } }, reload: function(){ location.reload(); }, current_url: function(url){ rcl_update_history_url(url); }, dialog: function(dialog){ if(dialog.content){ if(jQuery('#ssi-modalContent').size()) ssi_modal.close(); var ssiOptions = { className: 'rcl-dialog-tab ' + (dialog.class? ' ' + dialog.class: ''), sizeClass: dialog.size? dialog.size: 'auto', content: dialog.content, buttons: [] }; if(dialog.buttons){ ssiOptions.buttons = dialog.buttons; } var buttonClose = true; if ('buttonClose' in dialog) { buttonClose = dialog.buttonClose; } if(buttonClose){ ssiOptions.buttons.push({ label: Rcl.local.close, closeAfter: true }); } if ('onClose' in dialog) { ssiOptions.onClose = function(m){ window[dialog.onClose[0]].apply(this, dialog.onClose[1]); }; } if(dialog.title) ssiOptions.title = dialog.title; ssi_modal.show(ssiOptions); } if(dialog.close){ ssi_modal.close(); } } }; for(var method in result){ if(methods[method]){ methods[method](result[method]); } } } function rcl_ajax(prop){ if(prop.data.ask){ if(!confirm(prop.data.ask)){ rcl_preloader_hide(); return false; } } if(typeof Rcl != 'undefined'){ if(typeof prop.data === 'string'){ prop.data += '&ajax_nonce=' + Rcl.nonce; }else if(typeof prop.data === 'object'){ prop.data.ajax_nonce = Rcl.nonce; } } var action = false; if(typeof prop.data === 'string'){ var propData = prop.data.split('&'); var propObj={}; for(var key in propData) { propObj[propData[key].split("=")[0]] = propData[key].split("=")[1]; } action = propObj.action; }else if(typeof prop.data === 'object'){ action = prop.data.action; } jQuery.ajax({ type: 'POST', data: prop.data, dataType: 'json', url: (typeof ajaxurl !== 'undefined')? ajaxurl: Rcl.ajaxurl, success: function(result, post){ if(!result){ rcl_notice(Rcl.local.error, 'error', 5000); return false; } if(result.error || result.errors){ rcl_preloader_hide(); if(result.errors){ jQuery.each(result.errors, function( index, error ) { rcl_notice(error, 'error', 5000); }); }else{ rcl_notice(result.error, 'error', 5000); } if(prop.error) prop.error(result); return false; } if(!result.preloader_live){ rcl_preloader_hide(); } if(result.success){ rcl_notice(result.success, 'success', 5000); } if(result.warning){ rcl_notice(result.warning, 'warning', 5000); } rcl_do_action('rcl_ajax_success', result); if(prop.success){ prop.success(result); }else{ rcl_proccess_ajax_return(result); } rcl_do_action(action, result); } }); } function rcl_send_form_data(action,e){ var form = jQuery(e).parents('form'); if(!rcl_check_form(form)) return false; if(e && jQuery(e).parents('.preloader-parent')){ rcl_preloader_show(jQuery(e).parents('.preloader-parent')); } rcl_ajax({ data: form.serialize() + '&action=' + action }); } function rcl_check_form(form){ var rclFormFactory = new RclForm(form); return rclFormFactory.validate(); } function rcl_add_beat(beat_name,delay,data){ delay = (delay < 10)? 10: delay; var data = (data)? data: false; var i = rcl_beats.length; rcl_beats[i] = { beat_name: beat_name, delay :delay, data: data }; } function rcl_remove_beat(beat_name){ if(!rcl_beats) return false; var remove = false; var all_beats = rcl_beats; all_beats.forEach(function(beat, index, all_beats){ if(beat.beat_name != beat_name) return; delete rcl_beats[index]; remove = true; }); return remove; } function rcl_exist_beat(beat_name){ if(!rcl_beats) return false; var exist = false; rcl_beats.forEach(function(beat, index, rcl_beats){ if(beat.beat_name != beat_name) return; exist = true; }); return exist; } function rcl_init_table(table_id){ jQuery('#' + table_id).on('click','.rcl-table__cell-must-sort',function(){ jQuery('#' + table_id).find('.rcl-table__cell-must-sort, .rcl-table__cell-sort').removeClass('rcl-table__cell-current-sort'); var sortCell = jQuery(this); var sortby = sortCell.data('sort'); var route = sortCell.attr('data-route'); sortCell.addClass('rcl-table__cell-current-sort'); jQuery('#' + table_id).find('[data-'+sortby+'-value]').addClass('rcl-table__cell-current-sort'); var list = jQuery('#' + table_id + ' .rcl-table__row-must-sort'); list.sort(function(a, b){ var aVal = jQuery(a).find('[data-'+sortby+'-value]').data(sortby+'-value'); var bVal = jQuery(b).find('[data-'+sortby+'-value]').data(sortby+'-value'); if(route == 'asc') return (aVal < bVal) - (aVal > bVal); else return (aVal > bVal) - (aVal < bVal); }); sortCell.attr('data-route', (route == 'desc'? 'asc': 'desc')); jQuery('#' + table_id + ' .rcl-table__row-must-sort').remove(); list.each(function(i,e){ jQuery('#' + table_id + ' .rcl-table__row-header').after(jQuery(this)); }); }); } function RclForm(form){ this.form = form; this.errors = {}; this.validate = function(){ var valid = true; for(var objKey in this.checkForm){ var chekObject = this.checkForm[objKey]; if(!chekObject.isValid.call(this)){ valid = false; break; } }; if(this.errors){ for(var k in this.errors){ this.showError(this.errors[k]); }; } return valid; }; this.addChekForm = function(id, data){ this.checkForm[id] = data; }; this.addChekFields = function(id, data){ this.checkFields[id] = data; }; this.addError = function(id, error){ this.errors[id] = error; }; this.shake = function(shakeBox){ shakeBox.css('box-shadow','red 0px 0px 5px 1px inset').animateCss('shake'); }; this.noShake = function(shakeBox){ shakeBox.css('box-shadow','none'); }; this.showError = function(error){ rcl_notice(error, 'error', 10000); }; this.checkForm = { checkFields: { isValid: function(){ var valid = true; var parent = this; this.form.find('input,select,textarea').each(function(){ var field = jQuery(this); var typeField = field.attr('type'); if(field.tagName && field.tagName.toLowerCase() == 'textarea') { typeField = 'textarea'; } for(var objKey in parent.checkFields){ var chekObject = parent.checkFields[objKey]; if(chekObject.types.length && jQuery.inArray( typeField, chekObject.types ) < 0){ continue; } var shakeBox = (typeField == 'checkbox')? field.next('label'): field; if(!chekObject.isValid(field)){ parent.shake(shakeBox); parent.addError(objKey, chekObject.errorText()); valid = false; return; }else{ parent.noShake(shakeBox); } }; }); return valid; } } }; this.checkFields = { required: { types: [], isValid: function(field){ var required = true; if(!field.is(":required")) return required; var value = false; if(field.attr('type') == 'checkbox'){ if(field.is(":checked")){ value = true; } }else{ if(field.val()) value = true; } if(!value){ required = false; } return required; }, errorText: function(){ return Rcl.errors.required; } }, numberRange: { types: ['number'], isValid: function(field){ var range = true; var val = field.val(); if(val === '') return true; val = parseInt(val); var min = parseInt(field.attr('min')); var max = parseInt(field.attr('max')); if(min != 'undefined' && min > val || max != 'undefined' && max < val){ range = false; } return range; }, errorText: function(){ return Rcl.errors.number_range; } }, pattern: { types: ['text', 'tel'], isValid: function(field){ var val = field.val(); if(!val) return true; var pattern = field.attr('pattern'); if(!pattern) return true; var re = new RegExp(pattern); return re.test(val); }, errorText: function(){ return Rcl.errors.pattern; } }, fileMaxSize: { types: ['file'], isValid: function(field){ var valid = true; field.each(function(){ var maxsize = jQuery(this).data("size"); var fileInput = jQuery(this)[0]; var file = fileInput.files[0]; if(!file) return; var filesize = file.size/1024/1024; if(filesize > maxsize){ valid = false; return; } }); return valid; }, errorText: function(){ return Rcl.errors.file_max_size; } }, fileAccept: { types: ['file'], isValid: function(field){ var valid = true; field.each(function(){ var fileInput = jQuery(this)[0]; var file = fileInput.files[0]; var accept = fileInput.accept.split(','); if(!file) return; if(accept){ var fileType = false; if(file.type){ for(var i in accept){ if(accept[i] == file.type){ fileType = true; return; } } } if(!fileType){ var exts = jQuery(this).data("ext").split(','); var filename = file.name; for(var i in exts){ if(filename.indexOf('.'+exts[i]) + 1) { fileType = true; return; } } } if(!fileType){ valid = false; return; } } }); return valid; }, errorText: function(){ return Rcl.errors.file_accept; } } }; this.send = function(action, success){ if(!this.validate()) return false; rcl_preloader_show(form); var sendData = { data: form.serialize() + '&action=' + action }; if(success){ sendData.success = success; } rcl_ajax(sendData); }; } jQuery(function($){ $.fn.extend({ insertAtCaret: function(myValue){ return this.each(function(i) { if (document.selection) { this.focus(); var sel = document.selection.createRange(); sel.text = myValue; this.focus(); } else if (this.selectionStart || this.selectionStart == '0') { var startPos = this.selectionStart; var endPos = this.selectionEnd; var scrollTop = this.scrollTop; this.value = this.value.substring(0, startPos)+myValue+this.value.substring(endPos,this.value.length); this.focus(); this.selectionStart = startPos + myValue.length; this.selectionEnd = startPos + myValue.length; this.scrollTop = scrollTop; } else { this.value += myValue; this.focus(); } }) } }); rcl_do_action('rcl_init'); }); jQuery(window).load(function() { jQuery('body').on('drop', function (e) { return false; }); jQuery(document.body).bind("drop", function(e){ e.preventDefault(); }); }); rcl_add_action('rcl_init','rcl_init_ajax_tab'); function rcl_init_ajax_tab(){ jQuery('body').on('click','.rcl-ajax',function(){ var e = jQuery(this); if(e.hasClass('tab-upload')) return false; rcl_do_action('rcl_before_upload_tab',e); rcl_ajax({ data:{ action: 'rcl_ajax_tab', post: e.data('post'), tab_url: e.attr('href') }, success: function(data){ e.removeClass('tab-upload'); data = rcl_apply_filters('rcl_upload_tab',data); if(data.result.error){ rcl_notice(data.result.error,'error',10000); return false; } var url = data.post.tab_url; var supports = data.post.supports; var subtab_id = data.post.subtab_id; if(supports && supports.indexOf('dialog')>=0){ if(!subtab_id){ ssi_modal.show({ className: 'rcl-dialog-tab '+data.post.tab_id, sizeClass: 'small', buttons: [{ label: Rcl.local.close, closeAfter: true }], content: data.result }); }else{ var box_id = '#ssi-modalContent'; } }else{ rcl_update_history_url(url); if(!subtab_id) jQuery('.rcl-tab-button .recall-button').removeClass('active'); e.addClass('active'); var box_id = '#lk-content'; } if(box_id){ jQuery(box_id).html(data.result); var options = rcl_get_options_url_params(); if(options.scroll == 1){ var offsetTop = jQuery(box_id).offset().top; jQuery('body,html').animate({scrollTop:offsetTop - options.offset}, 1000); } if(data.includes){ var includes = data.includes; includes.forEach(function(src, i, includes) { jQuery.getScript(src); }); } } if(!data.post.subtab_id){ jQuery('#lk-content').animateCss('fadeIn'); }else{ jQuery('#lk-content .rcl-subtab-content').animateCss('fadeIn'); } rcl_do_action('rcl_upload_tab',{element:e,result:data}); } }); return false; }); } function rcl_get_options_url_params(){ var options = { scroll:1, offset:100 }; options = rcl_apply_filters('rcl_options_url_params',options); return options; } function rcl_add_dropzone(idzone){ jQuery(document.body).bind("drop", function(e){ var dropZone = jQuery(idzone), node = e.target, found = false; if(dropZone[0]){ dropZone.removeClass('in hover'); do { if (node === dropZone[0]) { found = true; break; } node = node.parentNode; } while (node != null); if(found){ e.preventDefault(); }else{ return false; } } }); jQuery(idzone).bind('dragover', function (e) { var dropZone = jQuery(idzone), timeout = window.dropZoneTimeout; if (!timeout) { dropZone.addClass('in'); } else { clearTimeout(timeout); } var found = false, node = e.target; do { if (node === dropZone[0]) { found = true; break; } node = node.parentNode; } while (node != null); if (found) { dropZone.addClass('hover'); } else { dropZone.removeClass('hover'); } window.dropZoneTimeout = setTimeout(function () { window.dropZoneTimeout = null; dropZone.removeClass('in hover'); }, 100); }); } function passwordStrength(password){ var desc = new Array(); desc[0] = Rcl.local.pass0; desc[1] = Rcl.local.pass1; desc[2] = Rcl.local.pass2; desc[3] = Rcl.local.pass3; desc[4] = Rcl.local.pass4; desc[5] = Rcl.local.pass5; var score = 0; if (password.length > 6) score++; if ( ( password.match(/[a-z]/) ) && ( password.match(/[A-Z]/) ) ) score++; if (password.match(/\d+/)) score++; if ( password.match(/.[!,@,#,$,%,^,&,*,?,_,~,-,(,)]/) ) score++; if (password.length > 12) score++; document.getElementById("passwordDescription").innerHTML = desc[score]; document.getElementById("passwordStrength").className = "strength" + score; } function rcl_manage_user_black_list(e,user_id){ var class_i = jQuery(e).children('i').attr('class'); if(class_i=='rcli fa-refresh fa-spin') return false; jQuery(e).children('i').attr('class','rcli fa-refresh fa-spin'); rcl_ajax({ data: { action: 'rcl_manage_user_black_list', user_id: user_id }, success: function(data){ jQuery(e).children('i').attr('class',class_i); if(data['label']){ jQuery(e).find('span').text(data['label']); } } }); return false; } rcl_add_action('rcl_init','rcl_init_update_requared_checkbox'); function rcl_init_update_requared_checkbox(){ jQuery('body form').find('.required-checkbox').each(function(){ rcl_update_require_checkbox(this); }); jQuery('body form').on('click','.required-checkbox',function(){ rcl_update_require_checkbox(this); }); } function rcl_show_tab(id_block){ jQuery(".rcl-tab-button .recall-button").removeClass("active"); jQuery("#lk-content .recall_content_block").removeClass("active"); jQuery('#tab-button-'+id_block).children('.recall-button').addClass("active"); jQuery('#lk-content .'+id_block+'_block').addClass("active"); return false; } rcl_add_action('rcl_init','rcl_init_recallbar_hover'); function rcl_init_recallbar_hover(){ jQuery("#recallbar .menu-item-has-children").hover(function() { jQuery(this).children(".sub-menu").css({'visibility': 'visible'}); }, function() { jQuery(this).children(".sub-menu").css({'visibility': ''}); }); } rcl_add_action('rcl_before_upload_tab','rcl_add_class_upload_tab'); function rcl_add_class_upload_tab(e){ e.addClass('tab-upload'); } rcl_add_action('rcl_before_upload_tab','rcl_add_preloader_tab'); function rcl_add_preloader_tab(e){ rcl_preloader_show('#lk-content > div'); rcl_preloader_show('#ssi-modalContent > div'); } rcl_add_action('rcl_init','rcl_init_get_smilies'); function rcl_init_get_smilies(){ jQuery(document).on({ mouseenter: function () { var sm_box = jQuery(this).next(); var block = sm_box.children(); sm_box.show(); if(block.html()) return false; block.html(Rcl.local.loading+'...'); var dir = jQuery(this).data('dir'); rcl_ajax({ data: { action: 'rcl_get_smiles_ajax', area: jQuery(this).parent().data('area'), dir: dir? dir: 0 }, success: function(data){ if(data['content']){ block.html(data['content']); } } }); }, mouseleave: function () { jQuery(this).next().hide(); } }, "body .rcl-smiles .fa-smile-o"); } rcl_add_action('rcl_init','rcl_init_hover_smilies'); function rcl_init_hover_smilies(){ jQuery(document).on({ mouseenter: function () { jQuery(this).show(); }, mouseleave: function () { jQuery(this).hide(); } }, "body .rcl-smiles > .rcl-smiles-list"); jQuery('body').on('hover click','.rcl-smiles > img',function(){ var block = jQuery(this).next().children(); if(block.html()) return false; block.html(Rcl.local.loading+'...'); var dir = jQuery(this).data('dir'); rcl_ajax({ data: { action: 'rcl_get_smiles_ajax', area: jQuery(this).parent().data('area'), dir: dir? dir: 0 }, success: function(data){ if(data['content']){ block.html(data['content']); } } }); return false; }); } rcl_add_action('rcl_init','rcl_init_click_smilies'); function rcl_init_click_smilies(){ jQuery("body").on("click",'.rcl-smiles-list img',function(){ var alt = jQuery(this).attr("alt"); var area = jQuery(this).parents(".rcl-smiles").data("area"); jQuery("#"+area).val(jQuery("#"+area).val()+" "+alt+" "); }); } rcl_add_action('rcl_init','rcl_init_close_popup'); function rcl_init_close_popup(){ jQuery('#rcl-popup,.floatform').on('click','.close-popup',function(){ rcl_hide_float_login_form(); jQuery('#rcl-overlay').fadeOut(); jQuery('#rcl-popup').empty(); return false; }); } rcl_add_action('rcl_init','rcl_init_click_overlay'); function rcl_init_click_overlay(){ jQuery('#rcl-overlay').click(function(){ rcl_hide_float_login_form(); jQuery('#rcl-overlay').fadeOut(); jQuery('#rcl-popup').empty(); return false; }); } rcl_add_action('rcl_init','rcl_init_click_float_window'); function rcl_init_click_float_window(){ jQuery(".float-window-recall").on('click','.close',function(){ jQuery(".float-window-recall").remove(); return false; }); } rcl_add_action('rcl_init','rcl_init_loginform_shift_tabs'); function rcl_init_loginform_shift_tabs(){ jQuery('body').on('click','.form-tab-rcl .link-tab-rcl',function(){ jQuery('.form-tab-rcl').hide(); if(jQuery(this).hasClass('link-login-rcl')) rcl_show_login_form_tab('login'); if(jQuery(this).hasClass('link-register-rcl')) rcl_show_login_form_tab('register'); if(jQuery(this).hasClass('link-remember-rcl')) rcl_show_login_form_tab('remember'); return false; }); } rcl_add_action('rcl_init','rcl_init_check_url_params'); function rcl_init_check_url_params(){ var options = rcl_get_options_url_params(); if(rcl_url_params['tab']){ if(!jQuery("#lk-content").size()) return false; if(options.scroll == 1){ var offsetTop = jQuery("#lk-content").offset().top; jQuery('body,html').animate({scrollTop:offsetTop - options.offset}, 1000); } var id_block = rcl_url_params['tab']; rcl_show_tab(id_block); } } rcl_add_action('rcl_init','rcl_init_close_notice'); function rcl_init_close_notice(){ jQuery('#rcl-notice,body').on('click','a.close-notice',function(){ rcl_close_notice(jQuery(this).parent()); return false; }); } rcl_add_action('rcl_init','rcl_init_cookie'); rcl_add_action('rcl_login_form','rcl_init_login_form'); function rcl_init_login_form(type_form){ if(rcl_url_params['action-rcl']){ jQuery('.panel_lk_recall.floatform > div').hide(); } if(type_form=='floatform'){ jQuery("body").on('click','.rcl-register',function(){ rcl_show_float_login_form(); rcl_show_login_form_tab('register',type_form); return false; }); jQuery("body").on('click','.rcl-login',function(){ rcl_show_float_login_form(); rcl_show_login_form_tab('login',type_form); return false; }); if(rcl_url_params['action-rcl']){ rcl_show_float_login_form(); } }else{ if(rcl_url_params['action-rcl']==='login'){ jQuery('.rcl-loginform-full.'+type_form+' #register-form-rcl').hide(); } if(rcl_url_params['action-rcl']==='register'){ jQuery('.rcl-loginform-full.'+type_form+' #login-form-rcl').hide(); } if(rcl_url_params['action-rcl']==='remember'){ jQuery('.rcl-loginform.'+type_form+' #login-form-rcl').hide(); } } if(rcl_url_params['action-rcl']){ rcl_show_login_form_tab(rcl_url_params['action-rcl'],type_form); } } function rcl_show_login_form_tab(tab,type_form){ type_form = (!type_form)? '' : '.'+type_form; jQuery('.panel_lk_recall'+type_form+' #'+tab+'-form-rcl').show(); } function rcl_show_float_login_form(){ jQuery('.panel_lk_recall.floatform > div').hide(); rcl_setup_position_float_form(); jQuery('.panel_lk_recall.floatform').show(); } function rcl_hide_float_login_form(){ jQuery('.panel_lk_recall.floatform').fadeOut().children('.form-tab-rcl').hide(); } function rcl_setup_position_float_form(){ jQuery("#rcl-overlay").fadeIn(); var screen_top = jQuery(window).scrollTop(); var popup_h = jQuery('.panel_lk_recall.floatform').height(); var window_h = jQuery(window).height(); screen_top = screen_top + 60; jQuery('.panel_lk_recall.floatform').css('top', screen_top+'px'); } rcl_add_action('rcl_footer','rcl_beat'); function rcl_beat(){ var beats = rcl_apply_filters('rcl_beats',rcl_beats); var DataBeat = rcl_get_actual_beats_data(beats); if(rcl_beats_delay && DataBeat.length){ rcl_do_action('rcl_beat'); rcl_ajax({ data: { action: 'rcl_beat', databeat: JSON.stringify(DataBeat) }, success: function(data){ data.forEach(function(result, i, data) { rcl_do_action('rcl_beat_success_'+result['beat_name']); new (window[result['success']])(result['result']); }); } }); } rcl_beats_delay++; setTimeout('rcl_beat()', 1000); } function rcl_get_actual_beats_data(beats){ var beats_actual = new Array(); if(beats){ beats.forEach(function(beat, i, beats) { var rest = rcl_beats_delay % beat.delay; if(rest == 0){ var object = new (window[beat.beat_name])(beat.data); if(object.data){ object = rcl_apply_filters('rcl_beat_' + beat.beat_name,object); object.beat_name = beat.beat_name; var k = beats_actual.length; beats_actual[k] = object; } } }); } return beats_actual; } jQuery(function($){ jQuery('body').on('click','.rcl-form-add-user-count .rcl-get-form-pay',function(){ var id = jQuery(this).parents('.rcl-form-add-user-count').attr('id'); rcl_preloader_show('#'+id+' .rcl-form-input'); var dataString = 'action=rcl_add_count_user&' + jQuery('#'+id+' form').serialize(); rcl_ajax({ data: dataString, success: function(data){ if(data['otvet']==100){ jQuery('#'+id+' .rcl-result-box').html(data['redirectform']); } } }); return false; }); jQuery('body').on('click','.rcl-widget-balance .rcl-toggle-form-link',function(){ var id = jQuery(this).parents('.rcl-widget-balance').attr('id'); jQuery('#'+id+' .rcl-form-balance').slideToggle(200); return false; }); }); function rcl_pay_order_user_balance(e,data){ rcl_preloader_show(jQuery('.rcl-payment-buttons')); rcl_ajax({ data: { action: 'rcl_pay_order_user_balance', pay_id: data.pay_id, pay_type: data.pay_type, pay_summ: data.pay_summ, description: data.description, baggage_data: JSON.stringify(data.baggage_data) } }); return false; }function wau_get_payment_form(tariff_id, e){ if(e && jQuery(e).parents('.preloader-parent')){ rcl_preloader_show(jQuery(e).parents('.preloader-parent')); } rcl_ajax({ data:{ action: 'wau_ajax_get_payment_form', tariff_id: tariff_id } }); } function rcl_zoom_avatar(e){ var link = jQuery(e); var src = link.data('zoom'); ssi_modal.show({ sizeClass: 'auto', className: 'rcl-user-avatar-zoom', content: '<div id="rcl-preview"><img class=aligncenter src=\''+src+'\'></div>' }); jQuery('.rcl-user-avatar-zoom .ssi-modalWindow').animateCss('zoomIn'); } function rcl_get_user_info(element){ rcl_preloader_show('#lk-conteyner > div'); rcl_ajax({ data: { action: 'rcl_return_user_details', user_id: jQuery(element).parents('.wprecallblock').data('account') }, success: function(data){ if(data['content']){ ssi_modal.show({ title: Rcl.local.title_user_info, sizeClass: 'auto', className: 'rcl-user-getails', buttons: [{ label: Rcl.local.close, closeAfter: true }], content: '<div id="rcl-popup-content">'+data['content']+'</div>' }); } } }); } 